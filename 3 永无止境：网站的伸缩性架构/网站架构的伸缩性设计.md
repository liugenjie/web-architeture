# 网站架构的伸缩性设计

## 设计思想种类

- 根据功能进行物理分离实现伸缩，不同的服务器部署不同的任务、提供不同的功能。见图 6.1 通过物理分离实现服务器伸缩
  - 纵向分离（分层后分离），把业务处理流程分成不同的部分。见图 6.2 通过纵向分离部署实现系统伸缩性
  - 横向分离（业务分割后分离），把业务功能分成不同的模块。见图 6.3 通过横向分离部署实现系统伸缩性
- 单一功能通过集群实现伸缩，集群内的多台服务器部署相同的服务、提供相同的功能

## 应用服务器集群的伸缩性设计

- 通过负载均衡实现应用服务器伸缩性，见图 6.4 负载均衡实现应用服务器伸缩性

- 实现负载均衡的基础技术
  - HTTP 重定向负载均衡，见图 6.5 HTTP 重定向负载均衡原理
    - 优点：简单
    - 缺点：性能较差、重定向服务器自身处理能力受限、SEO作弊
  - DNS 域名解析负载均衡，见图 6.6 DNS 域名解析负载均衡原理
    - 优点：方便
    - 缺点：生效时间长、控制权
  - 反向代理负载均衡（也叫应用层负载均衡），见图 6.7 反向代理负载均衡原理
    - 优点：部署简单
    - 缺点：受限于负载均衡服务器的网卡带宽
  - IP 负载均衡（在网络层通过修改请求目标地址进行负载均衡），见图 6.8 IP 负载均衡原理
    - 优点：性能
    - 缺点：受限于负载均衡服务器的网卡带宽
  - 数据链路层负载均衡，见图 6.9 数据链路层负载均衡原理
    - 优点：使用最广，开源产品 LVS (Linux Virtual Server)

- 负载均衡算法
  - 轮询 Round Robin, RR
  - 加权轮询 Weighted Round Robin, WRR
  - 随机 Random
  - 最少连接 Least Connections
  - 源地址散列 Source Hashing

## 分布式缓存集群的伸缩性设计

- Memcached 分布式缓存集群的访问模型
  - 访问模型，见图 6.10 Memcached 分布式缓存集群的访问模型
  - 路由算法：
    - 余数 Hash 路由算法：用服务器数目除以缓存数据 key 的 hash 值，余数为服务器列表小标编号
    - 一致性 Hash 路由算法，见图 6.11 一致性 hash 算法原理

## 数据存储服务器集群的伸缩性设计

- 关系数据库集群的伸缩性设计
  - MySQL 集群伸缩性方案，见图 6.14 MySQL 集群伸缩性方案
    - 主从复制
    - 分库，不同的数据表部署在不同的数据库上
    - 分片，将一张表拆开分别存储在多个数据库中，支持分片的分布式关系数据库访问代理常用的有
      - Amoeba
      - Cobar，见图 6.15 Cobar 部署模型，图 6.16 Cobar 系统组件模型，图 6.18 利用 MySQL 同步机制实现 Cobar 集群伸缩

- NoSQL 数据库的伸缩性设计
  非关系的、分布式的数据库设计模式。一般而言 NoSQL 放弃了关系数据库的两大基础：以关系代数为基础的结构化查询语言（SQL）和事务一致性保证（ACID），而强化其他一些大型网站更关注的特性：高可用性和可伸缩性。
  - 目前使用最广泛的是：Apache HBase，见图 6.19 HBase 架构

